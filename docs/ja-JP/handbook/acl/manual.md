# ユーザーマニュアル

## ロール共用（Role Union）

ロール共用は権限管理モードです。システム設定に基づき、システム開発者は「独立ロール」、「ロール共用を許可」、または「ロール共用のみ」を選択して、異なる権限要件を満たすことができます。

![20250312184651](https://static-docs.nocobase.com/20250312184651.png)

### 独立ロール

デフォルトでは、システムは独立ロールを使用します。ユーザーは保有するロールを個別に切り替える必要があります。

![20250312184729](https://static-docs.nocobase.com/20250312184729.png)  
![20250312184826](https://static-docs.nocobase.com/20250312184826.png)

### ロール共用を許可

システム開発者は「ロール共用を許可」を有効にすることができ、ユーザーが割り当てられたすべてのロールの権限を同時に持つことを可能にすると同時に、ユーザーが個別にロールを切り替えることも許可します。

![20250312185006](https://static-docs.nocobase.com/20250312185006.png)

### ロール共用のみ

ユーザーはロール共用のみを使用することが強制され、個別にロールを切り替えることはできません。

![20250312185105](https://static-docs.nocobase.com/20250312185105.png)

### ロール共用のルール

ロール共用は、すべてのロールにわたる最大の権限を付与します。以下では、ロールが同じ権限に対して異なる設定を持っている場合の権限競合の解決方法について説明します。

#### 操作権限の統合

例：  
ロール1は「インターフェースの設定を許可」に設定され、ロール2は「プラグインのインストール、有効化、無効化を許可」に設定されています。

![20250312190133](https://static-docs.nocobase.com/20250312190133.png)  

![20250312190352](https://static-docs.nocobase.com/20250312190352.png)

**フル権限**ロールでログインすると、ユーザーは両方の権限を同時に持つことになります。

![20250312190621](https://static-docs.nocobase.com/20250312190621.png)

#### データ範囲の統合

##### データ行

シナリオ1：複数のロールが同じフィールドに条件を設定

ロールAフィルター：年齢 < 30  

| ユーザーID | 名前 | 年齢 |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBフィルター：年齢 > 25

| ユーザーID | 名前 | 年齢 |
| ------ | ---- | --- |
| 2      | Lily | 29  |
| 3      | Sam  | 32  |

**統合後：**

| ユーザーID | 名前 | 年齢 |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |
| 3      | Sam  | 32  |


シナリオ2：異なるロールが異なるフィールドに条件を設定

ロールAフィルター：年齢 < 30

| ユーザーID | 名前 | 年齢 |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBフィルター：名前に「Ja」を含む

| ユーザーID | 名前   | 年齢 |
| ------ | ------ | --- |
| 1      | Jack   | 23  |
| 3      | Jasmin | 27  |

**統合後：**

| ユーザーID | 名前   | 年齢 |
| ------ | ------ | --- |
| 1      | Jack   | 23  |
| 2      | Lily   | 29  |
| 3      | Jasmin | 27  |

##### データ列

ロールA表示列：名前、年齢

| ユーザーID | 名前 | 年齢 |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールB表示列：名前、性別

| ユーザーID | 名前 | 性別   |
| ------ | ---- | ----- |
| 1      | Jack | 男性   |
| 2      | Lily | 女性 |

**統合後：**

| ユーザーID | 名前 | 年齢 | 性別   |
| ------ | ---- | --- | ----- |
| 1      | Jack | 23  | 男性   |
| 2      | Lily | 29  | 女性 |

##### 行と列の混合
ロールAフィルター：年齢 < 30、列：名前、年齢

| ユーザーID | 名前 | 年齢 |
| ------ | ---- | --- |
| 1      | Jack | 23  |
| 2      | Lily | 29  |

ロールBフィルター：名前に「Ja」を含む、列：名前、性別

| ユーザーID | 名前  | 性別   |
| ------ | ----- | ----- |
| 3      | Jade  | 女性 |
| 4      | James | 男性   |

**統合後：**

| ユーザーID | 名前  | 年齢                                      | 性別                                        |
| ------ | ----- | ---------------------------------------- | ------------------------------------------ |
| 1      | Jack  | 23                                       | <span style="background-color:#FFDDDD">男性</span>   |
| 2      | Lily  | 29                                       | <span style="background-color:#FFDDDD">女性</span> |
| 3      | Jade  | <span style="background-color:#FFDDDD">27</span> | 女性                                      |
| 4      | James | <span style="background-color:#FFDDDD">31</span> | 男性                                        |

**注：赤い背景のセルは、個々のロールでは表示されないがロール統合時には表示されるデータを示します。**

##### まとめ

ロール統合のデータ範囲ルール：
1. 行間では、いずれかの条件が満たされれば、その行には権限があります。
2. 列間では、フィールドが組み合わされます。
3. 行と列の両方が設定されている場合、行と列は別々に統合され、行と列の組み合わせとしては統合されません。 